<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bakery Pro - Touch Edition</title>
    
    <style>
        :root { --blue: #3498db; --green: #2ecc71; --orange: #e67e22; --purple: #9b59b6; --bg: #f4f7f6; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 8px; display: flex; flex-direction: column; align-items: center; -webkit-tap-highlight-color: transparent; }
        
        @media print {
            .audio-bar, .tabs-header, .play-btn, .calc-btn, .drag-handle, .print-btn, .vol-slider, label, .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .container { box-shadow: none; border: none; width: 100% !important; }
            .tab-content { display: block !important; }
            .row { border-bottom: 1px solid #eee !important; }
        }

        .container { width: 100%; max-width: 500px; background: white; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); overflow: hidden; border: 1px solid #ddd; }
        
        /* –¢–ê–ë–û–í–ï */
        .tabs-header { display: flex; background: #fff; border-bottom: 2px solid #eee; padding: 6px; gap: 4px; overflow-x: auto; position: relative; }
        .tab-btn { flex: 1; min-width: 85px; padding: 10px 2px; cursor: pointer; font-weight: 800; font-size: 10px; border-radius: 8px; color: #7f8c8d; background: #fff; border: 2px solid #ecf0f1; display: flex; flex-direction: column; align-items: center; transition: 0.2s; touch-action: none; }
        .tab-btn.active { border-color: var(--blue); color: var(--blue); background: #f0f7ff; }
        .tab-btn[data-id="bread"].active { border-color: var(--green); color: var(--green); }
        .tab-btn[data-id="levain-ext"].active { border-color: var(--purple); color: var(--purple); }
        .dragging { opacity: 0.5; transform: scale(0.95); }

        .tab-content { display: none; padding: 12px; }
        .tab-content.active { display: block; }

        /* –†–ê–î–ò–û */
        .audio-bar { width: 100%; max-width: 500px; background: #000; color: white; padding: 10px; border-radius: 12px; margin-bottom: 8px; box-sizing: border-box; }
        .radio-controls { display: flex; justify-content: space-between; align-items: center; }
        .play-btn { border: none; color: white; padding: 8px 12px; border-radius: 8px; font-weight: 900; font-size: 10px; cursor: pointer; }
        .btn-nula { background: #e74c3c; }
        .btn-chill { background: #2ecc71; }

        /* –†–ï–î–û–í–ï */
        .row { display: flex; align-items: center; gap: 4px; margin-bottom: 6px; background: #fff; padding: 4px; border-radius: 6px; border: 1px solid #eee; }
        .name-in { flex: 1.5; font-weight: bold; padding: 8px 4px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; }
        .val-p { width: 55px; padding: 8px 2px; border: 1px solid #ddd; border-radius: 6px; text-align: center; }
        .res-box { background: #f0f7ff; padding: 8px 2px; border-radius: 6px; width: 75px; text-align: center; font-weight: 900; color: var(--blue); border: 2px solid #d0e4ff; }
        
        .sum-box { background: var(--green); color: white; padding: 12px; border-radius: 8px; text-align: center; font-size: 18px; font-weight: bold; margin: 15px 0; }
        .perc-section { margin-bottom: 12px; padding: 12px; border: 1.5px solid #eee; border-radius: 10px; background: #fafafa; }
        .calc-btn { background: var(--blue); color: white; border: none; padding: 10px; border-radius: 6px; width: 100%; font-weight: bold; margin-top: 8px; cursor: pointer; }
        .res-out { background: white; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-weight: 900; font-size: 22px; text-align: center; margin-top: 5px; }
        .print-btn { background: #34495e; color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

<div class="audio-bar no-print">
    <div class="radio-controls">
        <button class="play-btn btn-nula" id="btnNula" onclick="toggleRadio('nula')">‚ñ∂ NULA</button>
        <input type="range" min="0" max="1" step="0.1" value="0.5" oninput="changeVol(this.value)" style="width:60px">
        <button class="play-btn btn-chill" id="btnChill" onclick="toggleRadio('chill')">‚ñ∂ CHILL</button>
    </div>
</div>

<div class="container">
    <div class="tabs-header no-print" id="tabBar"></div>

    <div id="bread" class="tab-content active">
        <div style="background: #fff9e6; padding: 10px; border-radius: 8px; margin-bottom: 12px; border: 1px solid #f9ebbe;">
            <label style="font-size:10px; font-weight:bold; color:#7f8c8d;">–û–ë–©–û –¢–ï–°–¢–û (–≥—Ä):</label>
            <input type="text" id="targetTotal" style="width:100%; border:none; background:transparent; font-size:22px; font-weight:900;" value="1400" oninput="recalc()">
        </div>
        <div id="flour-list"></div>
        <div style="margin: 10px 0 5px 5px; font-size: 10px; font-weight: bold; color: #95a5a6;">–î–û–ë–ê–í–ö–ò</div>
        <div id="sortable-list"></div>
        <div class="sum-box">–û–ë–©–û: <span id="totalSum">0</span> –≥—Ä.</div>
        <button class="print-btn no-print" onclick="window.print()">üñ® –ü–†–ò–ù–¢–ò–†–ê–ô –†–ï–¶–ï–ü–¢–ê–¢–ê</button>
    </div>

    <div id="perc" class="tab-content">
        <div class="perc-section">
            <div style="font-size:13px; font-weight:bold;">–ö–∞–∫—ä–≤ –ø—Ä–æ—Ü–µ–Ω—Ç –µ?</div>
            <div style="display:flex; gap:5px; margin-top:8px;">
                <input type="number" id="p1_v1" class="val-p" style="flex:1" value="35"> –æ—Ç <input type="number" id="p1_v2" class="val-p" style="flex:1" value="1000">
            </div>
            <div id="p1_res" class="res-out">3.5 %</div>
            <button class="calc-btn" onclick="calcP1()">–ò–ó–ß–ò–°–õ–ò</button>
        </div>
        <div class="perc-section">
            <div style="font-size:13px; font-weight:bold;">–°—Ç–æ–π–Ω–æ—Å—Ç –æ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç?</div>
            <div style="display:flex; gap:5px; margin-top:8px;">
                <input type="number" id="p2_v1" class="val-p" style="flex:1" value="70"> % –æ—Ç <input type="number" id="p2_v2" class="val-p" style="flex:1" value="1000">
            </div>
            <div id="p2_res" class="res-out">700</div>
            <button class="calc-btn" style="background:var(--green)" onclick="calcP2()">–ò–ó–ß–ò–°–õ–ò</button>
        </div>
    </div>

    <div id="levain" class="tab-content">
        <div class="perc-section" style="border-left: 4px solid var(--orange);">
            <div style="font-size:13px; font-weight:bold;">–ö–≤–∞—Å –≤ —Ä–µ—Ü–µ–ø—Ç–∞—Ç–∞:</div>
            <div id="levain_needed" style="font-size:28px; font-weight:900; color:var(--orange);">0 –≥—Ä.</div>
        </div>
        <div class="perc-section">
            <div style="font-size:13px; font-weight:bold;">–•–∏–¥—Ä–∞—Ç–∞—Ü–∏—è –Ω–∞ —Ç–æ–∑–∏ –∫–≤–∞—Å (%):</div>
            <input type="number" id="levain_hydr" class="val-p" value="100" style="width:100%; font-size:20px; margin-top:8px;" oninput="recalc()">
        </div>
        <div style="display:flex; gap:8px;">
            <div class="perc-section" style="flex:1; text-align:center;">
                <div style="font-size:11px; font-weight:bold;">–ë–†–ê–®–ù–û</div>
                <div id="levain_flour_res" class="res-out" style="font-size:16px;">0 –≥—Ä.</div>
            </div>
            <div class="perc-section" style="flex:1; text-align:center;">
                <div style="font-size:11px; font-weight:bold;">–í–û–î–ê</div>
                <div id="levain_water_res" class="res-out" style="font-size:16px;">0 –≥—Ä.</div>
            </div>
        </div>
    </div>

    <div id="levain-ext" class="tab-content">
        <div class="perc-section" style="border-left: 4px solid var(--purple);">
            <div style="font-size:14px; font-weight:bold; color: var(--purple);">–ù–µ–∑–∞–≤–∏—Å–∏–º –ö–≤–∞—Å –ö–∞–ª–∫—É–ª–∞—Ç–æ—Ä</div>
        </div>
        <div class="perc-section">
            <label style="font-size:12px; font-weight:bold;">–û–±—â–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (–≥—Ä):</label>
            <input type="number" id="ext_total" class="val-p" value="300" style="width:100%; font-size:22px; margin-top:5px;" oninput="calcExtLevain()">
        </div>
        <div class="perc-section">
            <label style="font-size:12px; font-weight:bold;">–•–∏–¥—Ä–∞—Ç–∞—Ü–∏—è (%):</label>
            <input type="number" id="ext_hydr" class="val-p" value="100" style="width:100%; font-size:22px; margin-top:5px;" oninput="calcExtLevain()">
        </div>
        <div style="display:flex; gap:8px;">
            <div class="perc-section" style="flex:1; text-align:center;">
                <div style="font-size:11px; font-weight:bold;">–ë–†–ê–®–ù–û</div>
                <div id="ext_f_res" class="res-out" style="font-size:18px;">150 –≥—Ä.</div>
            </div>
            <div class="perc-section" style="flex:1; text-align:center;">
                <div style="font-size:11px; font-weight:bold;">–í–û–î–ê</div>
                <div id="ext_w_res" class="res-out" style="font-size:18px;">150 –≥—Ä.</div>
            </div>
        </div>
    </div>
</div>

<audio id="audioNula" src="https://stream.radionula.com/classics.mp3"></audio>
<audio id="audioChill" src="https://stream.zeno.fm/0r0xa792kwzuv"></audio>

<script>
    const tabConfig = [
        {id:'bread', label:'–†–ï–¶–ï–ü–¢–ê', icon:'ü•ñ'}, 
        {id:'perc', label:'–°–ú–ï–¢–ö–ò', icon:'ÔºÖ'}, 
        {id:'levain', label:'–ö–í–ê–° (–†–ï–¶)', icon:'üß™'},
        {id:'levain-ext', label:'–ö–í–ê–° (–ù–ï–ó–ê–í)', icon:'‚öñÔ∏è'}
    ];

    let draggedItem = null;

    window.onload = () => {
        renderTabBar(['bread', 'perc', 'levain', 'levain-ext']);
        renderIngredients(
            [{n:"–ë—è–ª–æ –ë—Ä–∞—à–Ω–æ", p:100}, {n:"–ü—ä–ª–Ω–æ–∑—ä—Ä–Ω–µ—Å—Ç–æ", p:0}], 
            [{n:"–í–æ–¥–∞", p:65}, {n:"–ö–≤–∞—Å", p:20}, {n:"–°–æ–ª", p:2}, {n:"–ó–µ—Ö—Ç–∏–Ω", p:0}, {n:"–î–æ–±–∞–≤–∫–∞ 1", p:0}, {n:"–î–æ–±–∞–≤–∫–∞ 2", p:0}]
        );
        recalc();
        calcExtLevain();
    };

    function renderTabBar(order) {
        const bar = document.getElementById('tabBar');
        bar.innerHTML = '';
        order.forEach(id => {
            const btn = document.createElement('button');
            btn.className = 'tab-btn';
            btn.dataset.id = id;
            btn.innerHTML = `<span>${tabConfig.find(c=>c.id===id).icon}</span> ${tabConfig.find(c=>c.id===id).label}`;
            
            // –ö–ª–∏–∫ –∑–∞ —Å–º—è–Ω–∞
            btn.onclick = () => switchTab(id);

            // Drag events (Mouse)
            btn.draggable = true;
            btn.onsubmit = (e) => e.preventDefault();
            btn.ondragstart = () => { draggedItem = id; btn.classList.add('dragging'); };
            btn.ondragover = (e) => e.preventDefault();
            btn.ondrop = () => {
                if(draggedItem !== id) {
                    const newOrder = [...order];
                    newOrder.splice(newOrder.indexOf(draggedItem), 1);
                    newOrder.splice(newOrder.indexOf(id), 0, draggedItem);
                    renderTabBar(newOrder);
                    switchTab(id);
                }
            };
            btn.ondragend = () => btn.classList.remove('dragging');

            bar.appendChild(btn);
        });
        const currentActive = document.querySelector('.tab-content.active').id;
        document.querySelector(`[data-id="${currentActive}"]`).classList.add('active');
    }

    function switchTab(id) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelector(`[data-id="${id}"]`).classList.add('active');
    }

    function renderIngredients(f, o) {
        const fL = document.getElementById('flour-list'), sL = document.getElementById('sortable-list');
        fL.innerHTML = ''; sL.innerHTML = '';
        f.forEach(i => fL.innerHTML += `<div class="row"><div></div><input type="text" class="name-in flour-n" value="${i.n}"><input type="number" class="val-p flour-p" value="${i.p}" oninput="recalc()"><div class="res-box flour-g">0</div></div>`);
        o.forEach(i => sL.innerHTML += `<div class="row"><div class="drag-handle">‚£ø</div><input type="text" class="name-in other-n" value="${i.n}"><input type="number" class="val-p other-p" value="${i.p}" oninput="recalc()"><div class="res-box other-g">0</div></div>`);
    }

    function recalc() {
        let fP = 0, tP = 0;
        document.querySelectorAll('.flour-p').forEach(el => fP += (parseFloat(el.value) || 0));
        document.querySelectorAll('.other-p').forEach(el => tP += (parseFloat(el.value) || 0));
        let target = eval(document.getElementById('targetTotal').value) || 0;
        let unit = (fP + tP) > 0 ? target / (fP + tP) : 0;
        document.querySelectorAll('.flour-g').forEach((el, i) => el.innerText = Math.round(unit * (parseFloat(document.querySelectorAll('.flour-p')[i].value) || 0)));
        let levG = 0;
        document.querySelectorAll('.other-g').forEach((el, i) => {
            let val = parseFloat(document.querySelectorAll('.other-p')[i].value) || 0;
            let g = unit * val; el.innerText = Math.round(g);
            if(document.querySelectorAll('.other-n')[i].value.toLowerCase().includes("–∫–≤–∞—Å")) levG = g;
        });
        document.getElementById('totalSum').innerText = Math.round(target);
        document.getElementById('levain_needed').innerText = Math.round(levG) + " –≥—Ä.";
        let h = parseFloat(document.getElementById('levain_hydr').value) || 100;
        let lf = levG / (1 + (h/100));
        document.getElementById('levain_flour_res').innerText = Math.round(lf) + " –≥—Ä.";
        document.getElementById('levain_water_res').innerText = Math.round(levG - lf) + " –≥—Ä.";
    }

    function calcExtLevain() {
        let total = parseFloat(document.getElementById('ext_total').value) || 0;
        let hydr = parseFloat(document.getElementById('ext_hydr').value) || 100;
        let flour = total / (1 + (hydr/100));
        document.getElementById('ext_f_res').innerText = Math.round(flour) + " –≥—Ä.";
        document.getElementById('ext_w_res').innerText = Math.round(total - flour) + " –≥—Ä.";
    }

    function toggleRadio(type) {
        const nula = document.getElementById('audioNula'), chill = document.getElementById('audioChill');
        const bN = document.getElementById('btnNula'), bC = document.getElementById('btnChill');
        if (type === 'nula') {
            if (nula.paused) { chill.pause(); nula.play(); bN.innerText="‚è∏ STOP"; bC.innerText="‚ñ∂ CHILL"; }
            else { nula.pause(); bN.innerText="‚ñ∂ NULA"; }
        } else {
            if (chill.paused) { nula.pause(); chill.play(); bC.innerText="‚è∏ STOP"; bN.innerText="‚ñ∂ NULA"; }
            else { chill.pause(); bC.innerText="‚ñ∂ CHILL"; }
        }
    }

    function changeVol(v) { document.getElementById('audioNula').volume = v; document.getElementById('audioChill').volume = v; }
    function calcP1() { let v1 = document.getElementById('p1_v1').value, v2 = document.getElementById('p1_v2').value; if(v2) document.getElementById('p1_res').innerText = ((v1/v2)*100).toFixed(2) + " %"; }
    function calcP2() { let v1 = document.getElementById('p2_v1').value, v2 = document.getElementById('p2_v2').value; if(v1 && v2) document.getElementById('p2_res').innerText = ((v1/100)*v2).toFixed(1); }
</script>
</body>
</html>
