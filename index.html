<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bakery Pro - Final Music Edition</title>
    
    <style>
        :root { --blue: #3498db; --green: #2ecc71; --orange: #e67e22; --purple: #9b59b6; --bg: #f4f7f6; --dark: #2c3e50; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 8px; display: flex; flex-direction: column; align-items: center; }
        
        /* –†–ê–î–ò–û –°–ï–ö–¶–ò–Ø */
        .radio-wrapper { width: 100%; max-width: 500px; margin-bottom: 8px; text-align: center; }
        #nula-container { display: none; width: 100%; height: 100px; background: #000; border-radius: 12px; overflow: hidden; border: 1px solid #333; margin-top: 5px; }
        .toggle-radio { background: var(--dark); color: white; border: none; padding: 10px 12px; border-radius: 20px; font-size: 10px; font-weight: bold; cursor: pointer; margin: 2px; }
        .btn-chill { background: var(--green); }
        .btn-grunge { background: #7f8c8d; }
        
        #audio-player-ui { display: none; margin-top: 10px; background: var(--dark); color: white; padding: 12px; border-radius: 12px; width: 100%; box-sizing: border-box; }
        iframe { width: 100%; height: 100%; border: none; }

        .container { width: 100%; max-width: 500px; background: white; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); overflow: hidden; border: 1px solid #ddd; }
        .tabs-header { display: flex; background: #fff; border-bottom: 2px solid #eee; padding: 6px; gap: 4px; overflow-x: auto; }
        .tab-btn { flex: 1; min-width: 85px; padding: 10px 2px; cursor: pointer; font-weight: 800; font-size: 10px; border-radius: 8px; color: #7f8c8d; background: #fff; border: 2px solid #ecf0f1; display: flex; flex-direction: column; align-items: center; }
        .tab-btn.active { border-color: var(--blue); color: var(--blue); background: #f0f7ff; }
        .tab-content { display: none; padding: 12px; }
        .tab-content.active { display: block; }

        .row { display: flex; align-items: center; gap: 4px; margin-bottom: 6px; background: #fff; padding: 4px; border-radius: 6px; border: 1px solid #eee; }
        .name-in { flex: 1.5; font-weight: bold; padding: 8px 4px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; width:40%; }
        .val-p { width: 55px; padding: 8px 2px; border: 1px solid #ddd; border-radius: 6px; text-align: center; font-weight: bold; }
        .res-box { background: #f0f7ff; padding: 8px 2px; border-radius: 6px; width: 75px; text-align: center; font-weight: 900; color: var(--blue); border: 2px solid #d0e4ff; }
        .sum-box { background: var(--green); color: white; padding: 12px; border-radius: 8px; text-align: center; font-size: 18px; font-weight: bold; margin: 15px 0; }
        .calc-btn { background: var(--blue); color: white; border: none; padding: 10px; border-radius: 6px; width: 100%; font-weight: bold; margin-top: 8px; cursor: pointer; }
        .res-out { background: white; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-weight: 900; font-size: 22px; text-align: center; margin-top: 5px; color: var(--blue); }
        label { font-size: 11px; font-weight: bold; color: #7f8c8d; }
    </style>
</head>
<body>

<div class="radio-wrapper">
    <button class="toggle-radio" onclick="toggleNula()">üéµ NULA</button>
    <button class="toggle-radio btn-chill" id="chillBtn" onclick="toggleStream('chill', 'https://icecast.wallis.ch/zenfm-high')">üçÉ CHILL</button>
    <button class="toggle-radio btn-grunge" id="grungeBtn" onclick="toggleStream('grunge', 'https://streaming.radionomy.com/90s-Alternative')">üé∏ 90s ALT</button>
    
    <div id="nula-container"><iframe src="https://radionula.com/player/classic"></iframe></div>
    <div id="audio-player-ui">
        <div id="stream-label" style="font-size: 10px; margin-bottom: 5px; letter-spacing: 1px;">–ñ–ò–í–û –ü–†–ï–î–ê–í–ê–ù–ï...</div>
        <audio id="mainAudio"></audio>
        <input type="range" min="0" max="1" step="0.1" value="0.5" oninput="document.getElementById('mainAudio').volume = this.value" style="width: 80%">
    </div>
</div>

<div class="container">
    <div class="tabs-header" id="tabBar"></div>

    <div id="bread" class="tab-content active">
        <div style="background: #fff9e6; padding: 10px; border-radius: 8px; margin-bottom: 12px; border: 1px solid #f9ebbe;">
            <label>–û–ë–©–û –¢–ï–°–¢–û (–≥—Ä):</label>
            <input type="number" id="targetTotal" style="width:100%; border:none; background:transparent; font-size:24px; font-weight:900; outline:none;" value="1400" oninput="recalc()">
        </div>
        
        <div class="row">
            <input type="text" class="name-in" value="–ë—è–ª–æ –ë—Ä–∞—à–Ω–æ" id="f1_n">
            <input type="number" class="val-p flour-p" value="100" id="f1_p" readonly>
            <div class="res-box flour-g" id="f1_g">0</div>
        </div>
        <div class="row">
            <input type="text" class="name-in" value="–ü—ä–ª–Ω–æ–∑—ä—Ä–Ω–µ—Å—Ç–æ" id="f2_n">
            <input type="number" class="val-p flour-p" value="0" id="f2_p" oninput="autoAdjustFlour()">
            <div class="res-box flour-g" id="f2_g">0</div>
        </div>

        <div style="margin: 10px 0 5px 5px; font-size: 10px; font-weight: bold; color: #95a5a6;">–î–û–ë–ê–í–ö–ò</div>
        <div id="other-ingredients"></div>
        <div class="sum-box">–û–ë–©–û: <span id="totalSum">0</span> –≥—Ä.</div>
        <button class="calc-btn" style="background:#34495e" onclick="window.print()">üñ® –ü–†–ò–ù–¢–ò–†–ê–ô</button>
    </div>

    <div id="perc" class="tab-content">
        <div class="row"><input type="number" id="p1_v1" class="val-p" value="35"><span>–æ—Ç</span><input type="number" id="p1_v2" class="val-p" value="1000"></div>
        <div id="p1_res" class="res-out">3.5 %</div>
        <button class="calc-btn" onclick="calcP1()">–ö–ê–ö–™–í % –ï?</button>
        <hr style="margin:20px 0; border:0; border-top:1px solid #eee;">
        <div class="row"><input type="number" id="p2_v1" class="val-p" value="70"><span>% –æ—Ç</span><input type="number" id="p2_v2" class="val-p" value="1000"></div>
        <div id="p2_res" class="res-out" style="color:var(--green);">700</div>
        <button class="calc-btn" style="background:var(--green)" onclick="calcP2()">–°–¢–û–ô–ù–û–°–¢ –û–¢ %</button>
    </div>

    <div id="levain" class="tab-content">
        <div class="res-out" id="levain_needed" style="font-size:32px; color:var(--orange);">0 –≥—Ä.</div>
        <label>–•–ò–î–†–ê–¢–ê–¶–ò–Ø –ù–ê –ö–í–ê–°–ê (%):</label>
        <input type="number" id="levain_hydr" class="val-p" value="100" style="width:100%;" oninput="recalc()">
        <div style="display:flex; gap:8px; margin-top:10px;">
            <div style="flex:1; text-align:center;"><label>–ë–†–ê–®–ù–û</label><div id="levain_flour_res" class="res-out" style="font-size:18px;">0</div></div>
            <div style="flex:1; text-align:center;"><label>–í–û–î–ê</label><div id="levain_water_res" class="res-out" style="font-size:18px;">0</div></div>
        </div>
    </div>
</div>

<script>
    let currentStream = null;
    const audio = document.getElementById('mainAudio');
    const ui = document.getElementById('audio-player-ui');

    function toggleNula() {
        const nula = document.getElementById('nula-container');
        nula.style.display = nula.style.display === 'block' ? 'none' : 'block';
        if(nula.style.display === 'block' && currentStream) stopStream();
    }

    function toggleStream(type, url) {
        document.getElementById('nula-container').style.display = 'none';
        if (currentStream === type) { stopStream(); } 
        else {
            currentStream = type; audio.src = url; audio.play(); ui.style.display = 'block';
            document.getElementById('stream-label').innerText = type.toUpperCase() + " –ü–õ–ï–™–†";
            document.getElementById(type + 'Btn').innerText = "‚è∏ STOP " + type.toUpperCase();
        }
    }

    function stopStream() {
        audio.pause(); audio.src = ""; ui.style.display = 'none';
        document.getElementById('chillBtn').innerText = "üçÉ CHILL";
        document.getElementById('grungeBtn').innerText = "üé∏ 90s ALT";
        currentStream = null;
    }

    function autoAdjustFlour() {
        let f2 = parseFloat(document.getElementById('f2_p').value) || 0;
        if (f2 > 100) f2 = 100;
        document.getElementById('f1_p').value = (100 - f2);
        recalc();
    }

    function recalc() {
        let target = parseFloat(document.getElementById('targetTotal').value) || 0;
        let otherP = 0;
        document.querySelectorAll('.other-p').forEach(el => otherP += (parseFloat(el.value) || 0));
        let unit = target / (100 + otherP);
        
        document.getElementById('f1_g').innerText = Math.round(unit * (parseFloat(document.getElementById('f1_p').value) || 0));
        document.getElementById('f2_g').innerText = Math.round(unit * (parseFloat(document.getElementById('f2_p').value) || 0));

        let levG = 0;
        document.querySelectorAll('.other-g').forEach((el, i) => {
            let p = parseFloat(document.querySelectorAll('.other-p')[i].value) || 0;
            let g = unit * p; el.innerText = Math.round(g);
            if(document.querySelectorAll('.other-n')[i].value.toLowerCase().includes("–∫–≤–∞—Å")) levG = g;
        });

        document.getElementById('totalSum').innerText = Math.round(target);
        let h = parseFloat(document.getElementById('levain_hydr').value) || 100;
        let lf = levG / (1 + (h/100));
        document.getElementById('levain_needed').innerText = Math.round(levG) + " –≥—Ä.";
        document.getElementById('levain_flour_res').innerText = Math.round(lf);
        document.getElementById('levain_water_res').innerText = Math.round(levG - lf);
    }

    window.onload = () => {
        const bar = document.getElementById('tabBar');
        [{id:'bread', label:'ü•ñ –†–ï–¶–ï–ü–¢–ê'}, {id:'perc', label:'ÔºÖ –°–ú–ï–¢–ö–ò'}, {id:'levain', label:'üß™ –ö–í–ê–°'}].forEach(t => {
            const btn = document.createElement('button'); btn.className = 'tab-btn'; btn.innerHTML = t.label;
            btn.onclick = () => {
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.getElementById(t.id).classList.add('active'); btn.classList.add('active');
            };
            bar.appendChild(btn);
        });
        document.querySelectorAll('.tab-btn')[0].classList.add('active');
        const sL = document.getElementById('other-ingredients');
        [{n:"–í–æ–¥–∞", p:65}, {n:"–ö–≤–∞—Å", p:20}, {n:"–°–æ–ª", p:2}, {n:"–ó–µ—Ö—Ç–∏–Ω", p:0}].forEach(i => {
            sL.innerHTML += `<div class="row"><input type="text" class="name-in other-n" value="${i.n}"><input type="number" class="val-p other-p" value="${i.p}" oninput="recalc()"><div class="res-box other-g">0</div></div>`;
        });
        recalc();
    };

    function calcP1() { let v1 = document.getElementById('p1_v1').value, v2 = document.getElementById('p1_v2').value; if(v2) document.getElementById('p1_res').innerText = ((v1/v2)*100).toFixed(2) + " %"; }
    function calcP2() { let v1 = document.getElementById('p2_v1').value, v2 = document.getElementById('p2_v2').value; if(v1 && v2) document.getElementById('p2_res').innerText = Math.round((v1/100)*v2); }
</script>
</body>
</html>
