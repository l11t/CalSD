<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bakery Pro - Mobile Optimized</title>
    <style>
        :root { --blue: #3498db; --green: #2ecc71; --orange: #e67e22; --bg: #f4f7f6; --dark: #2c3e50; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 5px; display: flex; flex-direction: column; align-items: center; }
        
        /* –ö–û–ú–ü–ê–ö–¢–ï–ù –ü–õ–ï–™–† */
        .radio-wrapper { width: 95%; max-width: 500px; margin-bottom: 5px; background: white; padding: 8px; border-radius: 10px; border: 1px solid #ddd; }
        .player-controls { display: flex; flex-direction: column; gap: 3px; }
        .file-label { background: var(--blue); color: white; padding: 8px; border-radius: 15px; font-size: 10px; font-weight: bold; cursor: pointer; display: block; text-align: center; }
        #file-input { display: none; }
        .nav-btns { display: flex; justify-content: center; gap: 5px; }
        .p-btn { background: var(--dark); color: white; border: none; padding: 6px 12px; border-radius: 10px; font-size: 12px; cursor: pointer; }
        #track-info { font-size: 9px; color: var(--blue); font-weight: bold; margin-top: 2px; }
        #track-name { font-size: 9px; color: #7f8c8d; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; margin: 0 auto; }

        .container { width: 100%; max-width: 500px; background: white; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); overflow: hidden; border: 1px solid #ddd; }
        .tabs-header { display: flex; background: #fff; border-bottom: 1px solid #eee; padding: 4px; gap: 2px; }
        .tab-btn { flex: 1; padding: 8px 1px; cursor: pointer; font-weight: 800; font-size: 9px; border-radius: 6px; color: #7f8c8d; background: #fff; border: 1px solid #ecf0f1; }
        .tab-btn.active { border-color: var(--blue); color: var(--blue); background: #f0f7ff; }
        
        .tab-content { display: none; padding: 8px; }
        .tab-content.active { display: block; }
        
        .main-inputs { background: #fff9e6; padding: 8px; border-radius: 8px; margin-bottom: 8px; border: 1px solid #f9ebbe; }
        .row { display: flex; align-items: center; gap: 4px; margin-bottom: 5px; background: white; border-radius: 6px; padding: 3px; border: 1px solid #eee; }
        .drag-handle { cursor: grab; color: #bdc3c7; font-size: 16px; padding: 0 4px; }
        .drag-handle::before { content: "‚†ø"; }
        .name-in { flex: 2; font-weight: bold; padding: 6px; border: 1px solid #ddd; border-radius: 5px; font-size: 12px; outline: none; }
        .val-p { width: 45px; padding: 6px; border: 1px solid #ddd; border-radius: 5px; text-align: center; font-weight: bold; font-size: 12px; }
        .res-box { background: #f0f7ff; padding: 6px; border-radius: 5px; width: 65px; text-align: center; font-weight: 900; color: var(--blue); border: 1px solid #d0e4ff; font-size: 12px; }
        
        .sum-box { background: var(--green); color: white; padding: 10px; border-radius: 8px; text-align: center; font-size: 16px; font-weight: bold; margin-top: 10px; }
        .res-out { background: white; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-weight: 900; font-size: 20px; text-align: center; color: var(--blue); }
        
        .calc-section { margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .calc-row { display: flex; align-items: center; justify-content: center; gap: 4px; flex-wrap: wrap; font-size: 11px; }
        .calc-input { width: 45px; padding: 5px; border: 1px solid #ddd; border-radius: 5px; text-align: center; }
        
        .action-btns { display: flex; gap: 5px; margin-top: 10px; }
        .btn { flex: 1; padding: 10px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; color: white; font-size: 11px; }
        .save-btn { background: var(--blue); }
        .reset-btn { background: #95a5a6; }
        label { font-size: 10px; font-weight: bold; color: #7f8c8d; margin-bottom: 3px; display: block; }
    </style>
</head>
<body>

<div class="radio-wrapper">
    <div class="player-controls">
        <label for="file-input" class="file-label">üìÅ –ó–ê–†–ï–î–ò –ü–ï–°–ù–ò</label>
        <input type="file" id="file-input" accept="audio/*" multiple onchange="handleFiles(event)">
        <div style="display:flex; justify-content: space-between; align-items: center; margin: 2px 0;">
            <div id="track-info">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç</div>
            <div id="track-name">–ù—è–º–∞ –∏–∑–±—Ä–∞–Ω–∏</div>
        </div>
        <div class="nav-btns">
            <button class="p-btn" onclick="prevTrack()">‚èÆ</button>
            <button class="p-btn" onclick="togglePlay()" id="play-pause-btn">‚è∏</button>
            <button class="p-btn" onclick="nextTrack()">‚è≠</button>
            <button class="p-btn" style="background:#e74c3c" onclick="stopMusic()">üõë</button>
        </div>
    </div>
    <audio id="mainAudio"></audio>
</div>

<div class="container">
    <div class="tabs-header">
        <button class="tab-btn active" onclick="openTab(event, 'bread')">ü•ñ –†–ï–¶–ï–ü–¢–ê</button>
        <button class="tab-btn" onclick="openTab(event, 'perc')">ÔºÖ –°–ú–ï–¢–ö–ò</button>
        <button class="tab-btn" onclick="openTab(event, 'levain-recipe')">üß™ –ö–í–ê–° (–†)</button>
        <button class="tab-btn" onclick="openTab(event, 'levain-ext')">‚öñÔ∏è –ö–í–ê–° (–û)</button>
    </div>

    <div id="bread" class="tab-content active">
        <div class="main-inputs">
            <div style="display:flex; gap:10px;">
                <div style="flex:1;">
                    <label>–û–ë–©–û –¢–ï–°–¢–û (–≥—Ä):</label>
                    <input type="number" id="targetTotal" style="width:100%; border:none; background:transparent; font-size:18px; font-weight:900; outline:none;" value="1400" oninput="recalc('total')">
                </div>
                <div style="flex:1; border-left:1px solid #f9ebbe; padding-left:10px;">
                    <label>–ë–†–ê–®–ù–û (–≥—Ä):</label>
                    <input type="number" id="targetFlour" style="width:100%; border:none; background:transparent; font-size:18px; font-weight:900; outline:none; color:var(--orange);" oninput="recalc('flour')">
                </div>
            </div>
        </div>
        <div id="sortable-list"></div>
        <div class="sum-box">–û–ë–©–û: <span id="totalSum">0</span> –≥—Ä.</div>
        <div class="action-btns">
            <button class="btn save-btn" onclick="saveRecipe()">üíæ –ó–ê–ü–ê–ó–ò</button>
            <button class="btn reset-btn" onclick="resetToTemplate()">üîÑ –ù–£–õ–ò–†–ê–ô</button>
        </div>
    </div>

    <div id="perc" class="tab-content">
        <div class="calc-section"><div class="calc-row"><input type="number" id="p1_v1" class="calc-input" value="10"><span> –µ % –æ—Ç </span><input type="number" id="p1_v2" class="calc-input" value="100">? = <input type="text" id="p1_res" class="val-p" readonly style="width:50px; padding:4px"> % <button class="save-btn" style="border:none;border-radius:5px;padding:4px 8px;color:white" onclick="calcP1()">!</button></div></div>
        <div class="calc-section"><div class="calc-row"><span>–ö–æ–ª–∫–æ —Å–∞ </span><input type="number" id="p2_v1" class="calc-input" value="10"><span> % –æ—Ç </span><input type="number" id="p2_v2" class="calc-input" value="100">? = <input type="text" id="p2_res" class="val-p" readonly style="width:50px; padding:4px"><button class="save-btn" style="border:none;border-radius:5px;padding:4px 8px;color:white" onclick="calcP2()">!</button></div></div>
    </div>

    <div id="levain-recipe" class="tab-content">
        <label>–ö–í–ê–° –í –†–ï–¶–ï–ü–¢–ê–¢–ê:</label><div id="lev_needed" class="res-out" style="color:var(--orange);">0 –≥—Ä.</div>
        <div style="display:flex; gap:10px; margin-top:8px;"><div style="flex:1;"><label>–ë–†–ê–®–ù–û</label><div id="l_f" class="res-out">0</div></div><div style="flex:1;"><label>–í–û–î–ê</label><div id="l_w" class="res-out">0</div></div></div>
    </div>

    <div id="levain-ext" class="tab-content">
        <label>–ñ–ï–õ–ê–ù–û –ö–û–õ-–í–û –ö–í–ê–° (–≥—Ä):</label><input type="number" id="ext_total" class="val-p" value="300" style="width:100%; margin-bottom:8px;" oninput="calcExtLevain()">
        <div style="display:flex; gap:10px;"><div style="flex:1;"><label>–ë–†–ê–®–ù–û</label><div id="ext_f_res" class="res-out">150</div></div><div style="flex:1;"><label>–í–û–î–ê</label><div id="ext_w_res" class="res-out">150</div></div></div>
    </div>
</div>

<script>
    let lastMode = 'total';
    const audio = document.getElementById('mainAudio');
    const trackInfo = document.getElementById('track-info');
    const trackNameDisp = document.getElementById('track-name');
    const playPauseBtn = document.getElementById('play-pause-btn');
    let playlist = []; let currentIndex = 0;

    function handleFiles(event) { playlist = Array.from(event.target.files); if (playlist.length > 0) { currentIndex = 0; playTrack(currentIndex); } }
    function playTrack(index) {
        if (index < 0 || index >= playlist.length) return;
        const file = playlist[index]; const url = URL.createObjectURL(file);
        audio.src = url; trackInfo.innerText = `${index + 1}/${playlist.length}`; trackNameDisp.innerText = file.name;
        audio.play(); playPauseBtn.innerText = "‚è∏";
    }
    function nextTrack() { if (playlist.length === 0) return; currentIndex = (currentIndex + 1) % playlist.length; playTrack(currentIndex); }
    function prevTrack() { if (playlist.length === 0) return; currentIndex = (currentIndex - 1 + playlist.length) % playlist.length; playTrack(currentIndex); }
    function togglePlay() { if (audio.paused) { audio.play(); playPauseBtn.innerText = "‚è∏"; } else { audio.pause(); playPauseBtn.innerText = "‚ñ∂"; } }
    function stopMusic() { audio.pause(); audio.src = ""; trackInfo.innerText = "---"; trackNameDisp.innerText = "–ù—è–º–∞"; }
    audio.onended = function() { nextTrack(); };

    const template = [
        {n:"–ë—è–ª–æ –ë—Ä–∞—à–Ω–æ", p:90, r:true}, {n:"–ü—ä–ª–Ω–æ–∑—ä—Ä–Ω–µ—Å—Ç–æ", p:10, r:false},
        {n:"–í–æ–¥–∞", p:64, r:false}, {n:"–°–æ–ª", p:2.25, r:false},
        {n:"–ó–µ—Ö—Ç–∏–Ω", p:1.25, r:false}, {n:"–ö–≤–∞—Å", p:0, r:false},
        {n:"", p:0, r:false}, {n:"", p:0, r:false}, {n:"", p:0, r:false}
    ];

    function openTab(e, name) {
        document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(name).style.display = 'block';
        e.currentTarget.classList.add('active');
    }
    function createRow(data) {
        const div = document.createElement('div');
        div.className = "row draggable"; div.draggable = true;
        div.innerHTML = `<div class="drag-handle"></div><input type="text" class="name-in" value="${data.n}"><input type="number" class="val-p ${data.r ? 'f1-p' : (data.n === '–ü—ä–ª–Ω–æ–∑—ä—Ä–Ω–µ—Å—Ç–æ' ? 'f2-p' : 'other-p')}" value="${data.p}" ${data.r ? 'readonly' : ''} oninput="${data.n === '–ü—ä–ª–Ω–æ–∑—ä—Ä–Ω–µ—Å—Ç–æ' ? 'adjustFlour()' : 'recalc(lastMode)'}"><div class="res-box">0</div>`;
        return div;
    }
    function adjustFlour() {
        const f2 = document.querySelector('.f2-p'), f1 = document.querySelector('.f1-p');
        if (f1 && f2) { let val = parseFloat(f2.value) || 0; if(val > 100) val = 100; f1.value = (100 - val).toFixed(2).replace(/\.?0+$/, ''); }
        recalc(lastMode);
    }
    function recalc(mode) {
        if(mode !== 'current') lastMode = mode;
        const tT = parseFloat(document.getElementById('targetTotal').value) || 0, tF = parseFloat(document.getElementById('targetFlour').value) || 0;
        let otherP = 0; document.querySelectorAll('.other-p').forEach(i => otherP += (parseFloat(i.value) || 0));
        let totalP = 100 + otherP;
        let unit = (lastMode === 'flour' && tF > 0) ? (tF / 100) : (tT / totalP);
        if(lastMode === 'total' && mode !== 'current') document.getElementById('targetFlour').value = Math.round(unit * 100);
        if(lastMode === 'flour' && mode !== 'current') document.getElementById('targetTotal').value = Math.round(unit * totalP);
        document.querySelectorAll('.row').forEach(row => {
            const p = parseFloat(row.querySelector('.val-p').value) || 0, res = Math.round(unit * p);
            row.querySelector('.res-box').innerText = res;
        });
        document.getElementById('totalSum').innerText = Math.round(unit * totalP);
        let levG = 0; document.querySelectorAll('.row').forEach(r => { if(r.querySelector('.name-in').value.toLowerCase().includes('–∫–≤–∞—Å')) levG = parseInt(r.querySelector('.res-box').innerText); });
        const lF = levG / 2;
        document.getElementById('lev_needed').innerText = Math.round(levG) + " –≥—Ä.";
        document.getElementById('l_f').innerText = Math.round(lF); document.getElementById('l_w').innerText = Math.round(levG - lF);
    }
    function calcP1() { const v1 = parseFloat(document.getElementById('p1_v1').value), v2 = parseFloat(document.getElementById('p1_v2').value); document.getElementById('p1_res').value = v2 ? ((v1/v2)*100).toFixed(1) : 0; }
    function calcP2() { const v1 = parseFloat(document.getElementById('p2_v1').value), v2 = parseFloat(document.getElementById('p2_v2').value); document.getElementById('p2_res').value = ((v1/100)*v2).toFixed(1); }
    function calcExtLevain() { const t = parseFloat(document.getElementById('ext_total').value) || 0; document.getElementById('ext_f_res').innerText = Math.round(t/2); document.getElementById('ext_w_res').innerText = Math.round(t/2); }
    function saveRecipe() {
        const rows = []; document.querySelectorAll('.row').forEach(row => { rows.push({ n: row.querySelector('.name-in').value, p: row.querySelector('.val-p').value, r: row.querySelector('.val-p').readOnly }); });
        localStorage.setItem('bakery_final', JSON.stringify(rows)); localStorage.setItem('bakery_total_final', document.getElementById('targetTotal').value); alert("–ó–∞–ø–∞–∑–µ–Ω–æ!");
    }
    function loadRecipe() {
        const saved = localStorage.getItem('bakery_final'), savedTotal = localStorage.getItem('bakery_total_final'), list = document.getElementById('sortable-list');
        list.innerHTML = ""; const data = saved ? JSON.parse(saved) : template;
        if(savedTotal) document.getElementById('targetTotal').value = savedTotal;
        data.forEach(item => list.appendChild(createRow(item))); recalc('total');
    }
    function resetToTemplate() { if(confirm("–ù—É–ª–∏—Ä–∞–Ω–µ?")) { localStorage.removeItem('bakery_final'); loadRecipe(); } }
    const list = document.getElementById('sortable-list');
    list.addEventListener('dragstart', e => e.target.classList.add('dragging'));
    list.addEventListener('dragend', e => { e.target.classList.remove('dragging'); recalc(lastMode); });
    list.addEventListener('dragover', e => {
        e.preventDefault(); const draggable = document.querySelector('.dragging'), afterElement = [...list.querySelectorAll('.draggable:not(.dragging)')].reduce((closest, child) => {
            const box = child.getBoundingClientRect(), offset = e.clientY - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) return { offset, element: child }; return closest;
        }, { offset: Number.NEGATIVE_INFINITY }).element;
        if (afterElement == null) list.appendChild(draggable); else list.insertBefore(draggable, afterElement);
    });
    window.onload = loadRecipe;
</script>
</body>
</html>
