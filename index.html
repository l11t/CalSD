<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bakery Pro - Ultimate Edition</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü•ñ</text></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <style>
        :root { 
            --blue: #3498db; --green: #2ecc71; --orange: #e67e22; 
            --bg: #f4f7f6; --dark: #2c3e50;
        }
        
        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            background: var(--bg); 
            margin: 0; padding: 8px; 
            display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden;
        }
        
        .container { width: 100%; max-width: 500px; background: white; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 15px; border: 1px solid #ddd; }

        .tabs-header { display: flex; background: #fff; border-bottom: 2px solid #eee; padding: 6px; gap: 4px; }
        .tab-btn { 
            flex: 1; padding: 10px 2px; cursor: pointer; 
            font-weight: 800; font-size: 11px; border-radius: 8px;
            transition: 0.2s; color: #7f8c8d; background: #fff;
            display: flex; flex-direction: column; align-items: center; gap: 2px;
            border: 2px solid #ecf0f1;
        }
        .tab-btn.active { border-color: var(--blue); color: var(--blue); background: #f0f7ff; }
        .tab-btn[data-id="bread"].active { border-color: var(--green); color: var(--green); background: #f0fff4; }
        .tab-btn[data-id="levain"].active { border-color: var(--orange); color: var(--orange); background: #fffaf0; }
        
        .tab-content { display: none; padding: 12px; animation: fadeIn 0.2s; }
        .tab-content.active { display: block; }

        .audio-bar { width: 100%; max-width: 500px; background: var(--dark); color: white; padding: 8px 15px; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; box-sizing: border-box; }
        .play-btn { background: var(--green); border: none; color: white; padding: 6px 12px; border-radius: 15px; font-weight: bold; font-size: 12px; }
        
        .scaling-header { background: #fff9e6; padding: 10px; border-radius: 8px; margin-bottom: 12px; border: 1px solid #f9ebbe; }
        
        .row { 
            display: flex; align-items: center; gap: 4px; 
            margin-bottom: 6px; background: #fff; padding: 4px; 
            border-radius: 6px; border: 1px solid #eee;
            width: 100%; box-sizing: border-box;
        }
        .drag-handle { color: #ccc; font-size: 16px; padding: 0 2px; }
        .name-in { flex: 1.5; font-weight: bold; padding: 8px 4px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; min-width: 0; }
        .val-p { width: 50px; padding: 8px 2px; border: 1px solid #ddd; border-radius: 6px; text-align: center; font-size: 13px; }
        .res-box { 
            background: #f0f7ff; padding: 8px 2px; border-radius: 6px; 
            width: 70px; text-align: center; font-weight: 900; 
            color: var(--blue); border: 2px solid #d0e4ff; font-size: 13px; 
            flex-shrink: 0;
        }
        
        .sum-box { background: var(--green); color: white; padding: 12px; border-radius: 8px; text-align: center; font-size: 18px; font-weight: bold; margin-top: 15px; }
        .perc-section { margin-bottom: 15px; padding: 10px; border: 1.5px solid #eee; border-radius: 8px; background: #fafafa; }
        .calc-btn { background: var(--blue); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 8px; font-size: 14px; }
        .res-out { background: white; padding: 8px; border: 2px solid #ddd; border-radius: 6px; font-weight: 900; font-size: 20px; text-align: center; margin-top: 5px; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="audio-bar">
    <button class="play-btn" id="audioBtn" onclick="toggleMusic()">‚ñ∂ RADIO</button>
    <input type="range" min="0" max="1" step="0.1" value="0.5" oninput="changeVol(this.value)" style="width:70px">
</div>

<div class="container">
    <div class="tabs-header" id="tabBar"></div>

    <div id="bread" class="tab-content">
        <div class="scaling-header">
            <div style="display: flex; gap: 8px;">
                <div style="flex: 1;">
                    <label style="font-size:10px; font-weight:bold; color: #7f8c8d;">–û–ë–©–û (–≥—Ä):</label>
                    <input type="text" id="targetTotal" style="width:100%; border:none; background:transparent; font-size:18px; font-weight:900;" placeholder="2*700" oninput="recalc()">
                </div>
                <div style="flex: 1; border-left: 1px solid #eee; padding-left: 8px;">
                    <label style="font-size:10px; font-weight:bold; color: #7f8c8d;">–ë–†–ê–®–ù–û:</label>
                    <input type="number" id="fixedFlour" style="width:100%; border:none; background:transparent; font-size:18px; font-weight:900; color:var(--blue);" oninput="scaleByFlour()">
                </div>
            </div>
            <div id="formulaResult" style="color:var(--orange); font-size:11px; font-weight:bold; margin-top:4px;"></div>
        </div>
        <div id="flour-list"></div>
        <div style="margin: 10px 0 5px 5px; font-size: 10px; font-weight: bold; color: #95a5a6; text-transform: uppercase;">–î–æ–±–∞–≤–∫–∏</div>
        <div id="sortable-list"></div>
        <div class="sum-box">–û–ë–©–û –¢–ï–°–¢–û: <span id="totalSum">0</span> –≥—Ä.</div>
    </div>

    <div id="perc" class="tab-content">
        <div class="perc-section">
            <div style="font-size:13px; font-weight:bold;">–ö–∞–∫—ä–≤ –ø—Ä–æ—Ü–µ–Ω—Ç –µ?</div>
            <div style="display:flex; align-items:center; gap:5px; margin-top:8px;">
                <input type="number" id="p1_v1" class="val-p" style="flex:1" value="32.5"> –æ—Ç <input type="number" id="p1_v2" class="val-p" style="flex:1" value="1000">
            </div>
            <div id="p1_res" class="res-out" style="color:var(--blue); border-color:var(--blue);">3.25 %</div>
            <button class="calc-btn" onclick="calcP1()">–ò–ó–ß–ò–°–õ–ò!</button>
        </div>
        <div class="perc-section">
            <div style="font-size:13px; font-weight:bold;">–°—Ç–æ–π–Ω–æ—Å—Ç –æ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç?</div>
            <div style="display:flex; align-items:center; gap:5px; margin-top:8px;">
                <input type="number" id="p2_v1" class="val-p" style="flex:1" value="3.25"> % –æ—Ç <input type="number" id="p2_v2" class="val-p" style="flex:1" value="1000">
            </div>
            <div id="p2_res" class="res-out" style="color:var(--green); border-color:var(--green);">32.5</div>
            <button class="calc-btn" style="background:var(--green)" onclick="calcP2()">–ò–ó–ß–ò–°–õ–ò!</button>
        </div>
    </div>

    <div id="levain" class="tab-content">
        <div class="perc-section" style="border-left: 4px solid var(--orange); border-color: var(--orange);">
            <div style="font-size:13px; font-weight:bold;">–ö–≤–∞—Å –Ω—É–∂–µ–Ω:</div>
            <div id="levain_needed" style="font-size:28px; font-weight:900; color:var(--orange);">0 –≥—Ä.</div>
        </div>
        <div class="perc-section">
            <div style="font-size:13px; font-weight:bold;">–•–∏–¥—Ä–∞—Ç–∞—Ü–∏—è –Ω–∞ –∫–≤–∞—Å–∞ (%):</div>
            <input type="number" id="levain_hydr" class="val-p" value="100" style="width:100%; font-size:20px; margin-top:8px;">
            <button class="calc-btn" style="background:var(--orange)" onclick="calcLevain()">–ò–ó–ß–ò–°–õ–ò –ö–í–ê–°–ê!</button>
        </div>
        <div style="display:flex; gap:8px;">
            <div class="perc-section" style="flex:1;">
                <div style="font-size:11px; font-weight:bold;">–ë–†–ê–®–ù–û</div>
                <div id="levain_flour_res" class="res-out" style="color:var(--green); border-color:var(--green); font-size:16px;">0 –≥—Ä.</div>
            </div>
            <div class="perc-section" style="flex:1;">
                <div style="font-size:11px; font-weight:bold;">–í–û–î–ê</div>
                <div id="levain_water_res" class="res-out" style="color:var(--blue); border-color:var(--blue); font-size:16px;">0 –≥—Ä.</div>
            </div>
        </div>
    </div>
</div>

<audio id="bgMusic" loop preload="none" src="https://stream.zeno.fm/0r0xa792kwzuv"></audio>

<script>
    let lastMode = 'total';
    const audio = document.getElementById('bgMusic');
    const tabConfig = [{ id: 'bread', label: '–†–ï–¶–ï–ü–¢–ê', icon: 'ü•ñ' }, { id: 'perc', label: '–°–ú–ï–¢–ö–ò', icon: 'ÔºÖ' }, { id: 'levain', label: '–ö–í–ê–°', icon: 'üß™' }];

    window.onload = () => {
        renderTabBar(['bread', 'perc', 'levain']);
        const data = JSON.parse(localStorage.getItem('bakeryFinalData')) || {
            target: "2*700",
            flours: [{n: "–ë—è–ª–æ –ë—Ä–∞—à–Ω–æ", p: 100}, {n: "–ü—ä–ª–Ω–æ–∑—ä—Ä–Ω–µ—Å—Ç–æ", p: 0}],
            others: [{n: "–í–æ–¥–∞", p: 64}, {n: "–ö–≤–∞—Å", p: 20}, {n: "–°–æ–ª", p: 2}, {n: "–ó–µ—Ö—Ç–∏–Ω", p: 0}]
        };
        document.getElementById('targetTotal').value = data.target;
        renderIngredients(data.flours, data.others);
        switchTab('bread');
        recalc();
    };

    function renderTabBar(order) {
        const bar = document.getElementById('tabBar'); bar.innerHTML = '';
        order.forEach(id => {
            const config = tabConfig.find(c => c.id === id);
            const btn = document.createElement('button');
            btn.className = 'tab-btn'; btn.dataset.id = id;
            btn.innerHTML = `<span>${config.icon}</span> ${config.label}`;
            btn.onclick = () => switchTab(id);
            bar.appendChild(btn);
        });
    }

    function switchTab(id) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelector(`.tab-btn[data-id="${id}"]`).classList.add('active');
    }

    function renderIngredients(flours, others) {
        const fList = document.getElementById('flour-list'); fList.innerHTML = '';
        flours.forEach(item => {
            fList.innerHTML += `<div class="row"><div style="width:20px"></div>
                <input type="text" class="name-in flour-n" value="${item.n}" oninput="recalc()">
                <input type="number" class="val-p flour-p" value="${item.p}" oninput="recalc()">
                <div class="res-box flour-g">0</div></div>`;
        });
        const oList = document.getElementById('sortable-list'); oList.innerHTML = '';
        others.forEach(item => {
            oList.innerHTML += `<div class="row"><div class="drag-handle">‚£ø</div>
                <input type="text" class="name-in other-n" value="${item.n}" oninput="recalc()">
                <input type="number" class="val-p other-p" value="${item.p}" oninput="recalc()">
                <div class="res-box other-g">0</div></div>`;
        });
    }

    function scaleByFlour() { lastMode = 'flour'; document.getElementById('targetTotal').value = ""; recalc(); }
    
    function recalc() {
        let flourPct = 0, totalPct = 0;
        document.querySelectorAll('.flour-p').forEach(el => flourPct += (parseFloat(el.value) || 0));
        document.querySelectorAll('.other-p').forEach(el => totalPct += (parseFloat(el.value) || 0));
        totalPct += flourPct;

        let unit = 0;
        if (lastMode === 'total') {
            const formula = document.getElementById('targetTotal').value;
            let target = 0; try { target = eval(formula.replace(/[^-()\d/*+.]/g, '')) || 0; } catch(e) {}
            document.getElementById('formulaResult').innerText = target > 0 ? "= " + target + " –≥—Ä." : "";
            if (target > 0 && totalPct > 0) unit = target / totalPct;
        } else {
            const fixed = parseFloat(document.getElementById('fixedFlour').value) || 0;
            if (fixed > 0 && flourPct > 0) unit = fixed / flourPct;
        }

        document.querySelectorAll('.flour-g').forEach((el, i) => el.innerText = Math.round(unit * (parseFloat(document.querySelectorAll('.flour-p')[i].value) || 0)));
        let levainG = 0;
        document.querySelectorAll('.other-g').forEach((el, i) => {
            let g = unit * (parseFloat(document.querySelectorAll('.other-p')[i].value) || 0);
            el.innerText = Math.round(g);
            if(document.querySelectorAll('.other-n')[i].value.toLowerCase().includes("–∫–≤–∞—Å")) levainG = g;
        });
        document.getElementById('totalSum').innerText = Math.round(unit * totalPct);
        document.getElementById('levain_needed').innerText = Math.round(levainG) + " –≥—Ä.";
        window.currentLevainTotal = levainG;
        calcLevain();
        saveData();
    }

    function calcLevain() {
        let total = window.currentLevainTotal || 0, hydr = parseFloat(document.getElementById('levain_hydr').value) || 100;
        let f = total / (1 + (hydr/100)), w = total - f;
        document.getElementById('levain_flour_res').innerText = Math.round(f) + " –≥—Ä.";
        document.getElementById('levain_water_res').innerText = Math.round(w) + " –≥—Ä.";
    }

    function saveData() {
        const data = {
            target: document.getElementById('targetTotal').value,
            flours: [...document.querySelectorAll('.flour-n')].map((el, i) => ({ n: el.value, p: document.querySelectorAll('.flour-p')[i].value })),
            others: [...document.querySelectorAll('.other-n')].map((el, i) => ({ n: el.value, p: document.querySelectorAll('.other-p')[i].value }))
        };
        localStorage.setItem('bakeryFinalData', JSON.stringify(data));
    }

    function toggleMusic() { 
        if(audio.paused) { audio.play(); document.getElementById('audioBtn').innerText = "‚è∏ PAUSE"; }
        else { audio.pause(); document.getElementById('audioBtn').innerText = "‚ñ∂ RADIO"; }
    }
    function changeVol(v) { audio.volume = v; }
    function calcP1() { let v1 = document.getElementById('p1_v1').value, v2 = document.getElementById('p1_v2').value; if(v2) document.getElementById('p1_res').innerText = ((v1/v2)*100).toFixed(1) + " %"; }
    function calcP2() { let v1 = document.getElementById('p2_v1').value, v2 = document.getElementById('p2_v2').value; if(v1 && v2) document.getElementById('p2_res').innerText = ((v1/100)*v2).toFixed(1); }
</script>
</body>
</html>
